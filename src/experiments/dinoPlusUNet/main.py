from pathlib import Path
import sys

sys.path.insert(0, "/home/guptav/cil-road-segmentation/")
from src.experiments.config import run_config
from src.experiments.utils import get_run_name, get_save_path_and_experiment_name

# Config generated by src.experiments.config.py#generate_config
cur_config = {
    "model": {
        "name": "dino_plus_unet",
        "params": {},
    },
    "dataset": {
        "name": "90k",
        "params": {"batch_size": 8, "num_workers": 4, "shuffle": True, "resize_to": (400, 400), "augment": ["geometric"]}
    },
    "train": {
        "n_epochs": 30,
        "optimizer": {"name": "Adam", "params": {"lr": 0.0005}},
        "loss": {"name": "BCELoss", "params": {}},
        "clip_grad": None,
        "n_gpus": 2
    },
}


if __name__ == "__main__":
    save_path, experiment_name = get_save_path_and_experiment_name(__file__)
    run_name = get_run_name(cur_config)

    run_config(cur_config, save_path, experiment_name, run_name, log_wandb=False)
