from src.experiments.config import run_config
from src.experiments.utils import get_run_name, get_save_path_and_experiment_name

# Config generated by src.experiments.config.py#generate_config
cur_config ={
    "model": {
        "name": "deeplabv3plus",
        "params": {
            "backbone": "resnet101",
            "output_stride": 4,
            "pretrained_backbone": True,
            "separable_conv": True,
            "mode": "debug"
        }
    },
    "dataset": {
        "name": "both_clusters",
        "params": {
            "batch_size": 4,
            "num_workers": 4,
            "shuffle": True,
            "resize_to": [
                400,
                400
            ],
            "augment": ["masked", "geometric"],
            "masking_params": {
                "noise_threshold": 100,
                "num_zero_patches": 10,
                "zero_patch_size": 50,
                "num_flip_patches": 50,
                "flip_patch_size": 20
            }
        }
    },
    "train": {
        "n_epochs": 1,
        "optimizer": {
            "name": "Adam",
            "params": {
                "lr": 0.0003
            }
        },
        "loss": "DiceBCELoss",
        "clip_grad": None,
        "n_gpus": 0
    }
}

if __name__ == '__main__':
    save_path, experiment_name = get_save_path_and_experiment_name(__file__)
    run_name = get_run_name(cur_config, 'masked')

    run_config(cur_config, save_path, experiment_name, run_name, log_wandb=False)
